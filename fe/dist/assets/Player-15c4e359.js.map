{"version":3,"file":"Player-15c4e359.js","sources":["../../src/Player.jsx"],"sourcesContent":["import { createSignal, createEffect, onMount, For } from \"solid-js\";\r\nimport { useParams } from \"@solidjs/router\";\r\nimport axios from \"axios\";\r\n\r\nimport state from \"./assets/img/state.svg\";\r\nimport indicator from \"./assets/img/indicator.svg\";\r\nimport ploading from \"./assets/img/ploading.svg\";\r\nimport poster from \"./assets/img/poster.jpg\";\r\nimport Artplayer from \"artplayer\";\r\n\r\nimport \"./css/player.scss\";\r\nimport \"./css/sidebar.scss\";\r\n\r\nfunction replaceHash(hash) {\r\n\tconst baseUrl = location.href.split(\"#\")[0];\r\n\tlocation.replace(baseUrl + \"#\" + hash);\r\n}\r\n\r\nexport default function App() {\r\n\tArtplayer.CONTROL_HIDE_TIME = 1000;\r\n\r\n\tlet { path } = useParams();\r\n\tpath = decodeURI(path);\r\n\r\n\tconst [filelist, setFilelist] = createSignal([]);\r\n\tconst [dirconf, setDirconf] = createSignal({});\r\n\r\n\tconst scandirPromise = axios\r\n\t\t.post(\"/scandir\", { path: decodeURI(path) })\r\n\t\t.then(({ data }) => {\r\n\t\t\tsetFilelist(data.data);\r\n\t\t\tsetDirconf({\r\n\t\t\t\talist: data.alist,\r\n\t\t\t});\r\n\t\t});\r\n\r\n\tlet ep = decodeURIComponent(location.hash.slice(1));\r\n\tif (ep === \"\") ep = localStorage.getItem(path) ?? null;\r\n\tconst [episode, setEpisode] = createSignal(ep);\r\n\r\n\tasync function getUrl(ep) {\r\n\t\tif (!dirconf().alist) {\r\n\t\t\treturn `/video/${encodeURI(path)}/${encodeURI(ep)}`;\r\n\t\t}\r\n\t\treturn await axios\r\n\t\t\t.post(\"/geturl\", { dir: path, ep })\r\n\t\t\t.then(({ data }) => data);\r\n\t}\r\n\r\n\tonMount(async () => {\r\n\t\tfunction initTime() {\r\n\t\t\tart.currentTime = localStorage.getItem(episode()) ?? 0;\r\n\t\t}\r\n\r\n\t\t(async function () {\r\n\t\t\tawait scandirPromise;\r\n\t\t\tif (ep === null) {\r\n\t\t\t\tsetEpisode(filelist()[0].file);\r\n\t\t\t\tinitTime();\r\n\t\t\t}\r\n\t\t\tif (filelist().every((u) => u.file != ep)) {\r\n\t\t\t\tsetEpisode(filelist()[0].file);\r\n\t\t\t\tlocalStorage.removeItem(episode());\r\n\t\t\t\tinitTime();\r\n\t\t\t}\r\n\t\t})();\r\n\r\n\t\twindow.art = new Artplayer({\r\n\t\t\tcontainer: document.getElementById(\"artplayer\"),\r\n\t\t\turl: await getUrl(episode()),\r\n\t\t\tscreenshot: true,\r\n\t\t\ttheme: \"#23ade5\",\r\n\t\t\tfullscreen: true,\r\n\t\t\tfullscreenWeb: true,\r\n\t\t\tminiProgressBar: true,\r\n\t\t\tpip: true,\r\n\t\t\thotkey: false,\r\n\t\t\tuseSSR: true,\r\n\t\t\tposter: poster,\r\n\r\n\t\t\ticons: {\r\n\t\t\t\tloading: `<div style=\"display:flex;flex-direction:column;align-items:center;\"><img src=\"${ploading}\" width=\"24\" height=\"24\"/><span style=\"font-style:normal;\">Loading</span></div>`,\r\n\t\t\t\tstate: `<img width=\"150\" heigth=\"150\" src=\"${state}\"/>`,\r\n\t\t\t\tindicator: `<img width=\"16\" heigth=\"16\" src=\"${indicator}\"/>`,\r\n\t\t\t},\r\n\t\t});\r\n\t\tart.on(\"resize\", () => {\r\n\t\t\tart.autoHeight();\r\n\t\t});\r\n\t\tart.on(\"video:timeupdate\", () => {\r\n\t\t\tart.currentTime && localStorage.setItem(episode(), art.currentTime);\r\n\t\t});\r\n\t\tart.on(\"video:ended\", () => {\r\n\t\t\tlocalStorage.removeItem(episode());\r\n\t\t\tconst nextVideo = getNextVideo();\r\n\t\t\tif (nextVideo) setEpisode(nextVideo);\r\n\t\t});\r\n\t\tcreateEffect(async () => {\r\n\t\t\treplaceHash(episode());\r\n\t\t\tlocalStorage.setItem(path, episode());\r\n\t\t\tawait art.switchUrl(await getUrl(episode()));\r\n\t\t\tart.pause();\r\n\t\t\tinitTime();\r\n\t\t});\r\n\r\n\t\tdocument.addEventListener(\"keydown\", async (event) => {\r\n\t\t\tif ([\"TEXTAREA\", \"INPUT\"].includes(event.target.tagName)) return;\r\n\t\t\tif (event.key === \"f\") {\r\n\t\t\t\tevent.preventDefault();\r\n\t\t\t\tart.fullscreenWebToggle();\r\n\t\t\t} else if (event.key === \" \") {\r\n\t\t\t\tevent.preventDefault();\r\n\t\t\t\tart.toggle();\r\n\t\t\t} else if (event.key === \"k\") {\r\n\t\t\t\tevent.preventDefault();\r\n\t\t\t\tart.forward = 80;\r\n\t\t\t} else if (event.key === \"ArrowRight\") {\r\n\t\t\t\tevent.preventDefault();\r\n\t\t\t\tart.forward = Artplayer.SEEK_STEP;\r\n\t\t\t} else if (event.key === \"ArrowLeft\") {\r\n\t\t\t\tevent.preventDefault();\r\n\t\t\t\tart.backward = Artplayer.SEEK_STEP;\r\n\t\t\t} else if (event.key === \"ArrowUp\") {\r\n\t\t\t\tevent.preventDefault();\r\n\t\t\t\tart.volume += Artplayer.VOLUME_STEP;\r\n\t\t\t} else if (event.key === \"ArrowDown\") {\r\n\t\t\t\tevent.preventDefault();\r\n\t\t\t\tart.volume -= Artplayer.VOLUME_STEP;\r\n\t\t\t} else if (/^\\d$/.test(event.key)) {\r\n\t\t\t\tevent.preventDefault();\r\n\t\t\t\tconst speed = parseInt(event.key);\r\n\t\t\t\tif (speed) art.playbackRate = speed;\r\n\t\t\t}\r\n\t\t});\r\n\t\tif (ep) initTime();\r\n\t});\r\n\tfunction getNextVideo() {\r\n\t\tlet id = 0;\r\n\t\tlet nextvideo = null;\r\n\t\twhile (filelist()[id].file != episode()) ++id;\r\n\t\tif (++id < filelist().length) nextvideo = filelist()[id].file;\r\n\t\treturn nextvideo;\r\n\t}\r\n\tasync function togetherStart() {\r\n\t\tconst id = await axios\r\n\t\t\t.post(\"/together/add\", {\r\n\t\t\t\turl: await getUrl(episode()),\r\n\t\t\t\tname: `${path} ${episode()}`,\r\n\t\t\t})\r\n\t\t\t.then((u) => u.data.id);\r\n\t\tlocation.href = `/together/${id}`;\r\n\t}\r\n\r\n\treturn (\r\n\t\t<div class=\"container-md mt-4\" id=\"container\">\r\n\t\t\t<div class=\"row\">\r\n\t\t\t\t<div class=\"col-md-10 col-sm-12 mb-3 player-wrapper\">\r\n\t\t\t\t\t<div id=\"artplayer\" innerHTML={Artplayer.html}></div>\r\n\t\t\t\t</div>\r\n\t\t\t\t<div\r\n\t\t\t\t\tclass=\"col-md-2 col-sm-12 mb-3 sidebar-wrapper\"\r\n\t\t\t\t\tstyle=\"position: relative\"\r\n\t\t\t\t>\r\n\t\t\t\t\t<div class=\"sidebar\">\r\n\t\t\t\t\t\t<div class=\"item-control-wrap\">\r\n\t\t\t\t\t\t\t<span\r\n\t\t\t\t\t\t\t\tclass=\"item item-control\"\r\n\t\t\t\t\t\t\t\ton:click={() => (location.href = \"/\")}\r\n\t\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\t\t返回\r\n\t\t\t\t\t\t\t</span>\r\n\t\t\t\t\t\t\t<span\r\n\t\t\t\t\t\t\t\tclass=\"item item-control\"\r\n\t\t\t\t\t\t\t\ton:click={() =>\r\n\t\t\t\t\t\t\t\t\t(location.href = \"/add?s=\" + encodeURIComponent(path))\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\t\t更新\r\n\t\t\t\t\t\t\t</span>\r\n\t\t\t\t\t\t\t<span class=\"item item-control\" on:click={togetherStart}>\r\n\t\t\t\t\t\t\t\t一起看\r\n\t\t\t\t\t\t\t</span>\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t<For each={filelist()}>\r\n\t\t\t\t\t\t\t{(u) => (\r\n\t\t\t\t\t\t\t\t<span\r\n\t\t\t\t\t\t\t\t\tclassList={{\r\n\t\t\t\t\t\t\t\t\t\titem: true,\r\n\t\t\t\t\t\t\t\t\t\tactive: u.file === episode(),\r\n\t\t\t\t\t\t\t\t\t}}\r\n\t\t\t\t\t\t\t\t\ton:click={() => setEpisode(u.file)}\r\n\t\t\t\t\t\t\t\t\ttitle={u.name}\r\n\t\t\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\t\t\t{u.name}\r\n\t\t\t\t\t\t\t\t</span>\r\n\t\t\t\t\t\t\t)}\r\n\t\t\t\t\t\t</For>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</div>\r\n\t\t\t</div>\r\n\t\t</div>\r\n\t);\r\n}\r\n"],"names":["replaceHash","hash","baseUrl","location","href","split","replace","App","Artplayer","CONTROL_HIDE_TIME","path","useParams","decodeURI","filelist","setFilelist","createSignal","dirconf","setDirconf","scandirPromise","axios","post","then","data","alist","ep","decodeURIComponent","slice","localStorage","getItem","episode","setEpisode","getUrl","dir","encodeURI","onMount","initTime","art","currentTime","file","every","u","removeItem","container","document","getElementById","url","screenshot","theme","fullscreen","fullscreenWeb","miniProgressBar","pip","hotkey","useSSR","poster","icons","loading","ploading","state","indicator","on","autoHeight","setItem","nextVideo","getNextVideo","createEffect","switchUrl","pause","addEventListener","event","includes","target","tagName","key","preventDefault","fullscreenWebToggle","toggle","forward","SEEK_STEP","backward","volume","VOLUME_STEP","test","speed","parseInt","playbackRate","id","nextvideo","length","togetherStart","name","_el$","_tmpl$","_el$2","firstChild","_el$3","_el$4","_el$5","nextSibling","_el$6","_el$7","_el$8","_el$9","_el$10","encodeURIComponent","_$createComponent","For","each","children","_el$11","_tmpl$2","_$effect","_p$","_v$","_v$2","e","classList","t","_$setAttribute","undefined","innerHTML","html"],"mappings":"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"}